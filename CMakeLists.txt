cmake_minimum_required(VERSION 3.12)
list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake")
project(JoshUpscale VERSION 1.0 LANGUAGES CXX CUDA)
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CUDA_STANDARD 17)
set(CMAKE_CUDA_STANDARD_REQUIRED ON)
if(NOT DEFINED CMAKE_CUDA_ARCHITECTURES)
  set(CMAKE_CUDA_ARCHITECTURES 50)
endif()

if(MSVC)
  add_definitions(-D_CRT_SECURE_NO_WARNINGS)
endif()

option(ENABLE_LINT "Enable linting" OFF)
if(ENABLE_LINT)
  if(MSVC)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /W4 /WX")
  else()
    add_compile_options(-Wall -Wextra -Wpedantic -Werror)
  endif()
  if (NOT MSVC)
    find_program(CLANG_TIDY "clang-tidy" REQUIRED)
    find_program(CPPLINT "cpplint" REQUIRED)
    find_program(CPPCHECK "cppcheck" REQUIRED)
    set(CMAKE_CXX_CLANG_TIDY "${CLANG_TIDY};--checks=-clang-diagnostic-unused-command-line-argument;--warnings-as-errors=*")
    set(CMAKE_CXX_CPPLINT "${CPPLINT};--quiet")
    set(CMAKE_CXX_CPPCHECK "${CPPCHECK};-q;--enable=warning;--error-exitcode=1")
  endif()
endif()

add_subdirectory(core)
